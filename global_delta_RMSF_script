import pandas as pd

file1 = "/input_file_path/file1.xlsx" #file path for input Excel file generated by the per-residue RMSF script for the 1st conformational ensemble
file2 = "/input_file_path/file2.xlsx" #file path for input Excel file generated by the per-residue RMSF script for the 2nd conformational ensemble
output_file = "/output_file_path/output_global_delta_RMSF_file.xlsx" #file path for output Excel file

def calculate_rmsf_differences(file1, file2, output_file):
    df1 = pd.read_excel(file1)
    df2 = pd.read_excel(file2)
    if df1.shape[0] != df2.shape[0]:
        print(f"Error: Files {file1} and {file2} have mismatched rows. Cannot proceed.")
        return
    rmsf_diff = abs(df1['RMSF (Å)'] - df2['RMSF (Å)'])
    mean_diff = rmsf_diff.mean()
    combined_df = pd.concat(
        [
            df1.add_prefix('File1_'),
            df2.add_prefix('File2_'),
            rmsf_diff.rename('Delta_RMSF (Å)')
        ],
        axis=1
    )
    combined_df['Global_Delta_RMSF (Å)'] = [mean_diff] + [None] * (len(combined_df) - 1)
    combined_df.to_excel(output_file, index=False)
    print(f"Comparison results saved to: {output_file}")

if __name__ == "__main__":
    calculate_rmsf_differences(file1, file2, output_file)
